{% extends "base.html" %}

{% block title %}Notifications - ProjectX{% endblock %}

{% block content %}
<div class="page-header">
    <div style="display: flex; align-items: center; justify-content: space-between;">
        <div>
            <h1 style="font-size: 24px; font-weight: 700; margin: 0;">Notifications</h1>
            <p style="color: var(--text-secondary); font-size: 14px; margin-top: 4px;">All captured notifications from your devices</p>
        </div>
        <span style="font-size: 13px; color: var(--text-muted);">{{ all_count }} total</span>
    </div>
</div>

<div class="page-content">
    <style>
        .filter-tabs { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 24px; }
        .filter-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            background: var(--bg-tertiary);
            border: 1px solid transparent;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.15s;
        }
        .filter-tab:hover { border-color: var(--sidebar-border); }
        .filter-tab.active { background: var(--accent-primary); color: white; border-color: var(--accent-primary); }
        .filter-tab .dot { width: 8px; height: 8px; border-radius: 50%; }
        .filter-tab .count { font-size: 12px; color: inherit; opacity: 0.7; }
        .notif-card {
            background: var(--bg-secondary);
            border: 1px solid var(--sidebar-border);
            border-radius: 10px;
            padding: 16px 20px;
            margin-bottom: 12px;
            display: flex;
            gap: 16px;
        }
        .notif-badge {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
            color: white;
            flex-shrink: 0;
        }
        .notif-content { flex: 1; min-width: 0; }
        .notif-header { display: flex; align-items: center; gap: 10px; margin-bottom: 4px; }
        .notif-sender { font-size: 14px; font-weight: 600; }
        .notif-tag {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .notif-tag.urgent { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .notif-tag.sms { background: rgba(34, 197, 94, 0.15); color: #22c55e; }
        .notif-subject { font-size: 13px; color: var(--text-secondary); margin-bottom: 4px; }
        .notif-preview { font-size: 13px; color: var(--text-primary); line-height: 1.5; }
        .notif-time { flex-shrink: 0; text-align: right; }
        .notif-time-date { font-size: 12px; color: var(--text-muted); }
        .notif-time-hour { font-size: 12px; color: var(--text-muted); }
        .empty-state {
            background: var(--bg-secondary);
            border: 1px solid var(--sidebar-border);
            border-radius: 12px;
            padding: 48px 20px;
            text-align: center;
        }
        .empty-state p { color: var(--text-muted); font-size: 14px; margin: 0; }
        .pagination { display: flex; justify-content: center; align-items: center; gap: 12px; margin-top: 24px; }
        .pagination a {
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            color: var(--text-primary);
            text-decoration: none;
            font-size: 13px;
        }
        .pagination span { font-size: 13px; color: var(--text-muted); }
    </style>

    <!-- Filter Tabs -->
    <div class="filter-tabs">
        <a href="/notifications?app=all" class="filter-tab {% if current_app == 'all' %}active{% endif %}">
            All <span class="count">{{ all_count }}</span>
        </a>
        <a href="/notifications?app=whatsapp" class="filter-tab {% if current_app == 'whatsapp' %}active{% endif %}">
            <span class="dot" style="background: #25D366;"></span> WhatsApp <span class="count">{{ app_counts.get('whatsapp', 0) }}</span>
        </a>
        <a href="/notifications?app=instagram" class="filter-tab {% if current_app == 'instagram' %}active{% endif %}">
            <span class="dot" style="background: #E4405F;"></span> Instagram <span class="count">{{ app_counts.get('instagram', 0) }}</span>
        </a>
        <a href="/notifications?app=telegram" class="filter-tab {% if current_app == 'telegram' %}active{% endif %}">
            <span class="dot" style="background: #0088cc;"></span> Telegram <span class="count">{{ app_counts.get('telegram', 0) }}</span>
        </a>
        <a href="/notifications?app=slack" class="filter-tab {% if current_app == 'slack' %}active{% endif %}">
            <span class="dot" style="background: #4A154B;"></span> Slack <span class="count">{{ app_counts.get('slack', 0) }}</span>
        </a>
        <a href="/notifications?app=discord" class="filter-tab {% if current_app == 'discord' %}active{% endif %}">
            <span class="dot" style="background: #5865F2;"></span> Discord <span class="count">{{ app_counts.get('discord', 0) }}</span>
        </a>
        <a href="/notifications?app=sms" class="filter-tab {% if current_app == 'sms' %}active{% endif %}">
            <span class="dot" style="background: #6B7280;"></span> SMS <span class="count">{{ app_counts.get('sms', 0) }}</span>
        </a>
        <a href="/notifications?app=messenger" class="filter-tab {% if current_app == 'messenger' %}active{% endif %}">
            <span class="dot" style="background: #0084FF;"></span> Messenger <span class="count">{{ app_counts.get('messenger', 0) }}</span>
        </a>
        <a href="/notifications?app=email" class="filter-tab {% if current_app == 'email' %}active{% endif %}">
            <span class="dot" style="background: #EA4335;"></span> Email <span class="count">{{ app_counts.get('email', 0) }}</span>
        </a>
    </div>

    <!-- Notifications List -->
    {% if notifications %}
        {% for notif in notifications %}
        <div class="notif-card">
            {% if 'whatsapp' in notif.source %}
            <div class="notif-badge" style="background: #25D366;">WA</div>
            {% elif 'instagram' in notif.source %}
            <div class="notif-badge" style="background: #E4405F;">IG</div>
            {% elif 'telegram' in notif.source %}
            <div class="notif-badge" style="background: #0088cc;">TG</div>
            {% elif 'slack' in notif.source %}
            <div class="notif-badge" style="background: #4A154B;">SL</div>
            {% elif 'discord' in notif.source %}
            <div class="notif-badge" style="background: #5865F2;">DC</div>
            {% elif 'messenger' in notif.source %}
            <div class="notif-badge" style="background: #0084FF;">FB</div>
            {% elif 'sms' in notif.source %}
            <div class="notif-badge" style="background: #6B7280;">SM</div>
            {% else %}
            <div class="notif-badge" style="background: #EA4335;">EM</div>
            {% endif %}
            <div class="notif-content">
                <div class="notif-header">
                    <span class="notif-sender">{{ notif.sender[:40] }}{% if notif.sender|length > 40 %}...{% endif %}</span>
                    {% if notif.urgency == 'URGENT' %}
                    <span class="notif-tag urgent">Urgent</span>
                    {% endif %}
                    {% if notif.sms_sent %}
                    <span class="notif-tag sms">SMS Sent</span>
                    {% endif %}
                </div>
                <div class="notif-subject">{{ notif.subject }}</div>
                <div class="notif-preview">{{ notif.snippet[:150] }}{% if notif.snippet|length > 150 %}...{% endif %}</div>
            </div>
            <div class="notif-time">
                <div class="notif-time-date">{{ notif.created_at.strftime('%b %d') }}</div>
                <div class="notif-time-hour">{{ notif.created_at.strftime('%H:%M') }}</div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <p>No notifications found{% if current_app != 'all' %} for {{ current_app }}{% endif %}.</p>
            <p style="margin-top: 8px; font-size: 13px;">Notifications from your mobile app will appear here after syncing.</p>
        </div>
    {% endif %}

    <!-- Pagination -->
    {% if total > 20 %}
    <div class="pagination">
        {% if page > 1 %}
        <a href="/notifications?app={{ current_app }}&page={{ page - 1 }}">Previous</a>
        {% endif %}
        <span>Page {{ page }} of {{ ((total - 1) // 20) + 1 }}</span>
        {% if page * 20 < total %}
        <a href="/notifications?app={{ current_app }}&page={{ page + 1 }}">Next</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
