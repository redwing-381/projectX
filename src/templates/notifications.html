{% extends "base.html" %}

{% block title %}Notifications - ProjectX{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <h1 class="text-3xl font-bold">Notifications</h1>
        <span class="text-gray-400">{{ all_count }} total</span>
    </div>

    <!-- Filter Tabs -->
    <div class="flex flex-wrap gap-2 overflow-x-auto pb-2">
        <a href="/notifications?app=all" 
           class="px-4 py-2 rounded-lg font-medium transition-colors {% if current_app == 'all' %}bg-blue-600 text-white{% else %}bg-gray-700 text-gray-300 hover:bg-gray-600{% endif %}">
            All <span class="ml-1 px-2 py-0.5 rounded-full text-xs bg-gray-600">{{ all_count }}</span>
        </a>
        <a href="/notifications?app=whatsapp" 
           class="px-4 py-2 rounded-lg font-medium transition-colors {% if current_app == 'whatsapp' %}bg-green-600 text-white{% else %}bg-gray-700 text-gray-300 hover:bg-gray-600{% endif %}">
            <span class="inline-block w-3 h-3 rounded-full mr-1" style="background-color: #25D366;"></span>
            WhatsApp <span class="ml-1 px-2 py-0.5 rounded-full text-xs bg-gray-600">{{ app_counts.get('whatsapp', 0) }}</span>
        </a>
        <a href="/notifications?app=instagram" 
           class="px-4 py-2 rounded-lg font-medium transition-colors {% if current_app == 'instagram' %}bg-pink-600 text-white{% else %}bg-gray-700 text-gray-300 hover:bg-gray-600{% endif %}">
            <span class="inline-block w-3 h-3 rounded-full mr-1" style="background-color: #E4405F;"></span>
            Instagram <span class="ml-1 px-2 py-0.5 rounded-full text-xs bg-gray-600">{{ app_counts.get('instagram', 0) }}</span>
        </a>
        <a href="/notifications?app=telegram" 
           class="px-4 py-2 rounded-lg font-medium transition-colors {% if current_app == 'telegram' %}bg-blue-500 text-white{% else %}bg-gray-700 text-gray-300 hover:bg-gray-600{% endif %}">
            <span class="inline-block w-3 h-3 rounded-full mr-1" style="background-color: #0088cc;"></span>
            Telegram <span class="ml-1 px-2 py-0.5 rounded-full text-xs bg-gray-600">{{ app_counts.get('telegram', 0) }}</span>
        </a>
        <a href="/notifications?app=slack" 
           class="px-4 py-2 rounded-lg font-medium transition-colors {% if current_app == 'slack' %}bg-purple-700 text-white{% else %}bg-gray-700 text-gray-300 hover:bg-gray-600{% endif %}">
            <span class="inline-block w-3 h-3 rounded-full mr-1" style="background-color: #4A154B;"></span>
            Slack <span class="ml-1 px-2 py-0.5 rounded-full text-xs bg-gray-600">{{ app_counts.get('slack', 0) }}</span>
        </a>
        <a href="/notifications?app=discord" 
           class="px-4 py-2 rounded-lg font-medium transition-colors {% if current_app == 'discord' %}bg-indigo-600 text-white{% else %}bg-gray-700 text-gray-300 hover:bg-gray-600{% endif %}">
            <span class="inline-block w-3 h-3 rounded-full mr-1" style="background-color: #5865F2;"></span>
            Discord <span class="ml-1 px-2 py-0.5 rounded-full text-xs bg-gray-600">{{ app_counts.get('discord', 0) }}</span>
        </a>
        <a href="/notifications?app=sms" 
           class="px-4 py-2 rounded-lg font-medium transition-colors {% if current_app == 'sms' %}bg-gray-500 text-white{% else %}bg-gray-700 text-gray-300 hover:bg-gray-600{% endif %}">
            <span class="inline-block w-3 h-3 rounded-full mr-1 bg-gray-500"></span>
            SMS <span class="ml-1 px-2 py-0.5 rounded-full text-xs bg-gray-600">{{ app_counts.get('sms', 0) }}</span>
        </a>
        <a href="/notifications?app=messenger" 
           class="px-4 py-2 rounded-lg font-medium transition-colors {% if current_app == 'messenger' %}bg-blue-500 text-white{% else %}bg-gray-700 text-gray-300 hover:bg-gray-600{% endif %}">
            <span class="inline-block w-3 h-3 rounded-full mr-1" style="background-color: #0084FF;"></span>
            Messenger <span class="ml-1 px-2 py-0.5 rounded-full text-xs bg-gray-600">{{ app_counts.get('messenger', 0) }}</span>
        </a>
        <a href="/notifications?app=email" 
           class="px-4 py-2 rounded-lg font-medium transition-colors {% if current_app == 'email' %}bg-red-600 text-white{% else %}bg-gray-700 text-gray-300 hover:bg-gray-600{% endif %}">
            <span class="inline-block w-3 h-3 rounded-full mr-1" style="background-color: #EA4335;"></span>
            Email <span class="ml-1 px-2 py-0.5 rounded-full text-xs bg-gray-600">{{ app_counts.get('email', 0) }}</span>
        </a>
    </div>

    <!-- Notifications List -->
    <div class="space-y-4">
        {% if notifications %}
            {% for notif in notifications %}
            <div class="bg-gray-800 rounded-xl border border-gray-700 p-4 hover:border-gray-600 transition-colors">
                <div class="flex items-start gap-4">
                    <!-- App Badge -->
                    <div class="flex-shrink-0">
                        {% if 'whatsapp' in notif.source %}
                        <div class="w-10 h-10 rounded-full flex items-center justify-center text-white text-lg" style="background-color: #25D366;">W</div>
                        {% elif 'instagram' in notif.source %}
                        <div class="w-10 h-10 rounded-full flex items-center justify-center text-white text-lg" style="background-color: #E4405F;">I</div>
                        {% elif 'telegram' in notif.source %}
                        <div class="w-10 h-10 rounded-full flex items-center justify-center text-white text-lg" style="background-color: #0088cc;">T</div>
                        {% elif 'slack' in notif.source %}
                        <div class="w-10 h-10 rounded-full flex items-center justify-center text-white text-lg" style="background-color: #4A154B;">S</div>
                        {% elif 'discord' in notif.source %}
                        <div class="w-10 h-10 rounded-full flex items-center justify-center text-white text-lg" style="background-color: #5865F2;">D</div>
                        {% elif 'messenger' in notif.source %}
                        <div class="w-10 h-10 rounded-full flex items-center justify-center text-white text-lg" style="background-color: #0084FF;">M</div>
                        {% elif 'sms' in notif.source %}
                        <div class="w-10 h-10 rounded-full flex items-center justify-center text-white text-lg bg-gray-500">üì±</div>
                        {% else %}
                        <div class="w-10 h-10 rounded-full flex items-center justify-center text-white text-lg" style="background-color: #EA4335;">üìß</div>
                        {% endif %}
                    </div>
                    
                    <!-- Content -->
                    <div class="flex-grow min-w-0">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="font-medium text-gray-100">{{ notif.sender[:40] }}{% if notif.sender|length > 40 %}...{% endif %}</span>
                            {% if notif.urgency == 'URGENT' %}
                            <span class="px-2 py-0.5 bg-red-900 text-red-300 rounded text-xs font-medium">URGENT</span>
                            {% endif %}
                            {% if notif.sms_sent %}
                            <span class="text-green-400 text-sm" title="SMS sent">‚úì SMS</span>
                            {% endif %}
                        </div>
                        <p class="text-gray-400 text-sm mb-2">{{ notif.subject }}</p>
                        <p class="text-gray-300 text-sm">{{ notif.snippet[:150] }}{% if notif.snippet|length > 150 %}...{% endif %}</p>
                    </div>
                    
                    <!-- Timestamp -->
                    <div class="flex-shrink-0 text-right">
                        <p class="text-gray-500 text-sm">{{ notif.created_at.strftime('%b %d') }}</p>
                        <p class="text-gray-500 text-xs">{{ notif.created_at.strftime('%H:%M') }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="bg-gray-800 rounded-xl border border-gray-700 p-8 text-center">
                <p class="text-gray-400">No notifications found{% if current_app != 'all' %} for {{ current_app }}{% endif %}.</p>
                <p class="text-gray-500 text-sm mt-2">Notifications from your mobile app will appear here after syncing.</p>
            </div>
        {% endif %}
    </div>

    <!-- Pagination -->
    {% if total > 20 %}
    <div class="flex justify-center gap-2 mt-6">
        {% if page > 1 %}
        <a href="/notifications?app={{ current_app }}&page={{ page - 1 }}" 
           class="px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition-colors">
            ‚Üê Previous
        </a>
        {% endif %}
        
        <span class="px-4 py-2 text-gray-400">
            Page {{ page }} of {{ ((total - 1) // 20) + 1 }}
        </span>
        
        {% if page * 20 < total %}
        <a href="/notifications?app={{ current_app }}&page={{ page + 1 }}" 
           class="px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition-colors">
            Next ‚Üí
        </a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
