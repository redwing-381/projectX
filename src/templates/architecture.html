{% extends "base.html" %}

{% block title %}Architecture - ProjectX{% endblock %}

{% block content %}
<style>
    .arch-section { background: var(--bg-secondary); border: 1px solid var(--sidebar-border); border-radius: 12px; margin-bottom: 24px; }
    .arch-section-header { padding: 20px 24px; border-bottom: 1px solid var(--sidebar-border); }
    .arch-section-title { font-size: 16px; font-weight: 600; margin: 0; }
    .arch-section-body { padding: 24px; }
    .status-bar { display: flex; gap: 32px; padding: 16px 24px; background: var(--bg-secondary); border: 1px solid var(--sidebar-border); border-radius: 12px; margin-bottom: 24px; flex-wrap: wrap; }
    .status-item { display: flex; align-items: center; gap: 12px; }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; }
    .status-dot.green { background: #22c55e; }
    .status-dot.red { background: #ef4444; }
    .status-dot.gray { background: #6b7280; }
    .status-label { font-size: 13px; color: var(--text-muted); }
    .status-value { font-size: 14px; font-weight: 500; margin-left: 4px; }
    
    /* Visual Pipeline */
    .visual-pipeline { display: flex; flex-direction: column; gap: 0; position: relative; }
    .pipeline-row { display: flex; align-items: center; gap: 16px; }
    .pipeline-node { 
        background: var(--bg-tertiary); 
        border: 2px solid var(--sidebar-border); 
        border-radius: 12px; 
        padding: 16px 20px; 
        min-width: 180px;
        text-align: center;
        position: relative;
        transition: all 0.2s;
    }
    .pipeline-node:hover { border-color: var(--accent-primary); transform: translateY(-2px); }
    .pipeline-node.highlight { border-color: var(--accent-primary); background: rgba(59, 130, 246, 0.05); }
    .pipeline-node-icon { font-size: 24px; margin-bottom: 8px; }
    .pipeline-node-title { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
    .pipeline-node-desc { font-size: 12px; color: var(--text-muted); }
    .pipeline-arrow { 
        display: flex; 
        align-items: center; 
        color: var(--text-muted); 
        font-size: 20px;
        padding: 0 8px;
    }
    .pipeline-arrow svg { width: 24px; height: 24px; stroke: var(--text-muted); }
    
    /* Decision Flow */
    .decision-flow { padding: 20px 0; }
    .flow-step { display: flex; align-items: flex-start; margin-bottom: 0; position: relative; }
    .flow-connector { 
        width: 60px; 
        display: flex; 
        flex-direction: column; 
        align-items: center; 
        position: relative;
        flex-shrink: 0;
    }
    .flow-number { 
        width: 36px; 
        height: 36px; 
        border-radius: 50%; 
        background: var(--accent-primary); 
        color: white; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        font-weight: 600; 
        font-size: 14px;
        z-index: 2;
    }
    .flow-line { 
        width: 2px; 
        background: linear-gradient(180deg, var(--accent-primary), var(--sidebar-border)); 
        flex: 1;
        min-height: 60px;
    }
    .flow-step:last-child .flow-line { display: none; }
    .flow-content { 
        flex: 1; 
        background: var(--bg-tertiary); 
        border: 1px solid var(--sidebar-border); 
        border-radius: 10px; 
        padding: 16px 20px;
        margin-left: 16px;
        margin-bottom: 16px;
    }
    .flow-content:hover { border-color: var(--accent-primary); }
    .flow-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
    .flow-title { font-size: 15px; font-weight: 600; }
    .flow-badge { 
        font-size: 10px; 
        padding: 4px 10px; 
        border-radius: 12px; 
        font-weight: 600; 
        text-transform: uppercase; 
        letter-spacing: 0.5px;
    }
    .flow-badge.instant { background: rgba(34, 197, 94, 0.15); color: #22c55e; }
    .flow-badge.ai { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; }
    .flow-badge.output { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }
    .flow-desc { font-size: 13px; color: var(--text-secondary); line-height: 1.5; margin-bottom: 12px; }
    .flow-result { display: flex; gap: 12px; flex-wrap: wrap; }
    .flow-result-item { 
        font-size: 12px; 
        padding: 6px 12px; 
        background: var(--bg-secondary); 
        border-radius: 6px; 
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 6px;
    }
    .flow-result-item .dot { width: 6px; height: 6px; border-radius: 50%; }
    .flow-result-item .dot.green { background: #22c55e; }
    .flow-result-item .dot.gray { background: #6b7280; }
    
    /* Tech Grid */
    .tech-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
    @media (max-width: 900px) { .tech-grid { grid-template-columns: repeat(2, 1fr); } }
    .tech-item { display: flex; align-items: center; gap: 12px; padding: 14px 16px; background: var(--bg-tertiary); border-radius: 8px; }
    .tech-icon { width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; }
    .tech-name { font-size: 13px; font-weight: 500; }
    .tech-desc { font-size: 11px; color: var(--text-muted); }
    .platforms-grid { display: flex; flex-wrap: wrap; gap: 10px; }
    .platform-item { display: flex; align-items: center; gap: 8px; padding: 10px 14px; background: var(--bg-tertiary); border-radius: 6px; }
    .platform-dot { width: 8px; height: 8px; border-radius: 50%; }
    .platform-name { font-size: 13px; font-weight: 500; }
</style>
<div class="page-header">
    <div>
        <h1 style="font-size: 24px; font-weight: 700; margin: 0;">System Architecture</h1>
        <p style="color: var(--text-secondary); font-size: 14px; margin-top: 4px;">Technical overview of the notification processing system</p>
    </div>
</div>
<div class="page-content">
    <div class="status-bar">
        <div class="status-item"><span class="status-dot green"></span><span class="status-label">Server</span><span class="status-value">Online</span></div>
        <div class="status-item"><span class="status-dot {% if db_connected %}green{% else %}red{% endif %}"></span><span class="status-label">Database</span><span class="status-value">{% if db_connected %}Connected{% else %}Disconnected{% endif %}</span></div>
        <div class="status-item"><span class="status-dot {% if device_count > 0 %}green{% else %}gray{% endif %}"></span><span class="status-label">Devices</span><span class="status-value">{{ device_count }}</span></div>
    </div>

    <!-- Visual Data Flow -->
    <div class="arch-section">
        <div class="arch-section-header"><h2 class="arch-section-title">Data Flow Overview</h2></div>
        <div class="arch-section-body">
            <div class="pipeline-row" style="justify-content: center; flex-wrap: wrap; gap: 8px;">
                <div class="pipeline-node">
                    <div class="pipeline-node-icon">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                    </div>
                    <div class="pipeline-node-title">Gmail + Mobile</div>
                    <div class="pipeline-node-desc">Data Sources</div>
                </div>
                <div class="pipeline-arrow"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
                <div class="pipeline-node">
                    <div class="pipeline-node-icon">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
                    </div>
                    <div class="pipeline-node-title">FastAPI Server</div>
                    <div class="pipeline-node-desc">Processing</div>
                </div>
                <div class="pipeline-arrow"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
                <div class="pipeline-node highlight">
                    <div class="pipeline-node-icon">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
                    </div>
                    <div class="pipeline-node-title">AI Classification</div>
                    <div class="pipeline-node-desc">GPT-4o-mini</div>
                </div>
                <div class="pipeline-arrow"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
                <div class="pipeline-node">
                    <div class="pipeline-node-icon">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                    </div>
                    <div class="pipeline-node-title">SMS Alert</div>
                    <div class="pipeline-node-desc">Twilio</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Classification Pipeline Detail -->
    <div class="arch-section">
        <div class="arch-section-header"><h2 class="arch-section-title">Classification Pipeline</h2></div>
        <div class="arch-section-body">
            <div class="decision-flow">
                <div class="flow-step">
                    <div class="flow-connector"><div class="flow-number">1</div><div class="flow-line"></div></div>
                    <div class="flow-content">
                        <div class="flow-header"><span class="flow-title">VIP Sender Check</span><span class="flow-badge instant">Instant</span></div>
                        <div class="flow-desc">Check if sender matches any configured VIP email or domain. VIP messages skip all other checks.</div>
                        <div class="flow-result">
                            <div class="flow-result-item"><span class="dot green"></span>Match: Mark URGENT</div>
                            <div class="flow-result-item"><span class="dot gray"></span>No match: Continue</div>
                        </div>
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-connector"><div class="flow-number">2</div><div class="flow-line"></div></div>
                    <div class="flow-content">
                        <div class="flow-header"><span class="flow-title">Keyword Matching</span><span class="flow-badge instant">Instant</span></div>
                        <div class="flow-desc">Scan subject and preview for configured urgent keywords. Case-insensitive partial matching.</div>
                        <div class="flow-result">
                            <div class="flow-result-item"><span class="dot green"></span>Match: Mark URGENT</div>
                            <div class="flow-result-item"><span class="dot gray"></span>No match: Continue</div>
                        </div>
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-connector"><div class="flow-number">3</div><div class="flow-line"></div></div>
                    <div class="flow-content">
                        <div class="flow-header"><span class="flow-title">LLM Analysis</span><span class="flow-badge ai">AI Powered</span></div>
                        <div class="flow-desc">GPT-4o-mini analyzes message context, tone, and implied urgency to make classification decision.</div>
                        <div class="flow-result">
                            <div class="flow-result-item"><span class="dot green"></span>Urgent: Send Alert</div>
                            <div class="flow-result-item"><span class="dot gray"></span>Not Urgent: Log Only</div>
                        </div>
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-connector"><div class="flow-number">4</div><div class="flow-line"></div></div>
                    <div class="flow-content">
                        <div class="flow-header"><span class="flow-title">Alert Dispatch</span><span class="flow-badge output">Output</span></div>
                        <div class="flow-desc">Send condensed SMS alert via Twilio (160 chars max). Log all results to database for history.</div>
                        <div class="flow-result">
                            <div class="flow-result-item"><span class="dot green"></span>SMS sent to phone</div>
                            <div class="flow-result-item"><span class="dot gray"></span>Logged to dashboard</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tech Stack -->
    <div class="arch-section">
        <div class="arch-section-header"><h2 class="arch-section-title">Technology Stack</h2></div>
        <div class="arch-section-body">
            <div class="tech-grid">
                <div class="tech-item"><div class="tech-icon" style="background: rgba(55, 118, 171, 0.15); color: #3776AB;">PY</div><div><div class="tech-name">Python 3.11+</div><div class="tech-desc">Runtime</div></div></div>
                <div class="tech-item"><div class="tech-icon" style="background: rgba(0, 150, 136, 0.15); color: #009688;">FA</div><div><div class="tech-name">FastAPI</div><div class="tech-desc">Framework</div></div></div>
                <div class="tech-item"><div class="tech-icon" style="background: rgba(51, 103, 145, 0.15); color: #336791;">PG</div><div><div class="tech-name">PostgreSQL</div><div class="tech-desc">Database</div></div></div>
                <div class="tech-item"><div class="tech-icon" style="background: rgba(116, 170, 156, 0.15); color: #74AA9C;">AI</div><div><div class="tech-name">OpenRouter</div><div class="tech-desc">LLM Gateway</div></div></div>
                <div class="tech-item"><div class="tech-icon" style="background: rgba(234, 67, 53, 0.15); color: #EA4335;">GM</div><div><div class="tech-name">Gmail API</div><div class="tech-desc">Email</div></div></div>
                <div class="tech-item"><div class="tech-icon" style="background: rgba(241, 78, 50, 0.15); color: #F14E32;">TW</div><div><div class="tech-name">Twilio</div><div class="tech-desc">SMS</div></div></div>
                <div class="tech-item"><div class="tech-icon" style="background: rgba(15, 14, 71, 0.15); color: #6366f1;">RW</div><div><div class="tech-name">Railway</div><div class="tech-desc">Hosting</div></div></div>
                <div class="tech-item"><div class="tech-icon" style="background: rgba(61, 220, 132, 0.15); color: #3DDC84;">AD</div><div><div class="tech-name">Android</div><div class="tech-desc">Mobile</div></div></div>
            </div>
        </div>
    </div>

    <!-- Supported Platforms -->
    <div class="arch-section">
        <div class="arch-section-header"><h2 class="arch-section-title">Supported Platforms</h2></div>
        <div class="arch-section-body">
            <div class="platforms-grid">
                <div class="platform-item"><span class="platform-dot" style="background: #25D366;"></span><span class="platform-name">WhatsApp</span></div>
                <div class="platform-item"><span class="platform-dot" style="background: #E4405F;"></span><span class="platform-name">Instagram</span></div>
                <div class="platform-item"><span class="platform-dot" style="background: #0088cc;"></span><span class="platform-name">Telegram</span></div>
                <div class="platform-item"><span class="platform-dot" style="background: #4A154B;"></span><span class="platform-name">Slack</span></div>
                <div class="platform-item"><span class="platform-dot" style="background: #5865F2;"></span><span class="platform-name">Discord</span></div>
                <div class="platform-item"><span class="platform-dot" style="background: #0084FF;"></span><span class="platform-name">Messenger</span></div>
                <div class="platform-item"><span class="platform-dot" style="background: #6B7280;"></span><span class="platform-name">SMS</span></div>
                <div class="platform-item"><span class="platform-dot" style="background: #EA4335;"></span><span class="platform-name">Gmail</span></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
